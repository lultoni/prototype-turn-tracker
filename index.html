<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Turn Tracker — (GAME NAME)</title>
    <style>
        :root { --bg:#0f1221; --card:#151935; --text:#e8ebff; --muted:#b9c0ff; --accent:#7aa2ff; --accent2:#9bffdc; --danger:#ff6b6b; --ok:#2fd588; }
        *{box-sizing:border-box}
        html,body{height:100%}
        body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,Ubuntu,"Helvetica Neue",Arial,sans-serif;background:linear-gradient(180deg,#0d1020,#0f1221 60%,#0a0c18);color:var(--text);}
        .container{max-width:860px;margin:0 auto;padding:16px}
        .grid{display:grid;gap:12px}
        .grid.cols-2{grid-template-columns:1fr 1fr}
        @media (max-width:720px){.grid.cols-2{grid-template-columns:1fr}}
        .card{background:var(--card);border:1px solid #222a55;box-shadow:0 8px 30px rgba(0,0,0,.25);padding:14px;border-radius:16px}
        h1{font-size:1.35rem;margin:8px 0 12px;letter-spacing:.3px}
        h2{font-size:1.1rem;margin:0 0 8px;color:var(--muted)}
        .row{display:flex;gap:10px;flex-wrap:wrap;align-items:center}
        .pill{padding:6px 10px;border-radius:999px;background:#0c1130;border:1px solid #23306b;color:var(--muted);font-size:.9rem}
        .big{font-size:1.35rem;color:var(--text)}
        button{appearance:none;border:0;border-radius:12px;padding:10px 14px;background:var(--accent);color:#071021;font-weight:700;cursor:pointer;box-shadow:0 4px 12px rgba(122,162,255,.35)}
        button:active{transform:translateY(1px)}
        button.secondary{background:#1e2450;color:var(--text);box-shadow:none;border:1px solid #2a357a}
        button.danger{background:var(--danger);color:#fff;box-shadow:0 4px 12px rgba(255,107,107,.35)}
        button.ok{background:var(--ok);color:#062}
        .btn-row{display:flex;gap:8px;flex-wrap:wrap}
        .slot{display:inline-flex;align-items:center;gap:6px;padding:6px 10px;border:1px solid #2a357a;border-radius:999px;min-width:44px;justify-content:center}
        .slot input{width:18px;height:18px}
        .stat{display:flex;align-items:center;gap:8px;padding:8px 10px;border:1px solid #2a357a;border-radius:12px}
        .stat .val{font-weight:800;font-size:1.1rem}
        .counter{display:flex;align-items:center;gap:6px}
        .counter button{width:38px;padding:8px 0;text-align:center}
        .kpi{display:flex;gap:12px;flex-wrap:wrap}
        .kpi .item{background:#0c1130;border:1px solid #23306b;border-radius:14px;padding:8px 10px;min-width:120px}
        .muted{color:var(--muted)}
        .warn{color:var(--danger)}
        .success{color:var(--ok)}
        .divider{height:1px;background:#232a59;margin:10px 0}
        .notice{background:#0c1130;border:1px dashed #2a357a;border-radius:12px;padding:10px}
        .grow{flex:1}
        label{font-size:.92rem;color:var(--muted)}
        input[type="number"]{width:72px;padding:8px;border-radius:10px;border:1px solid #2a357a;background:#0c1130;color:var(--text)}
        .tiny{font-size:.8rem}
        .footer{opacity:.7;text-align:center;margin-top:12px}
    </style>
</head>
<body>
<div class="container grid cols-2">

    <section class="card">
        <h1>(GAME NAME) — Turn/Resource Tracker</h1>
        <div class="kpi">
            <div class="item"><div class="muted tiny">Round</div><div id="round" class="big">1</div></div>
            <div class="item"><div class="muted tiny">Current Player</div><div id="currentPlayer" class="big">P1</div></div>
            <div class="item"><div class="muted tiny">Rounds Since Capture</div><div id="rsc" class="big">0</div></div>
            <div class="item"><div class="muted tiny">Skill Slots (this turn)</div><div id="skillSlotsNow" class="big">2</div></div>
            <div class="item"><div class="muted tiny">Rune Gain at Round End</div><div id="runeGain" class="big">+1</div></div>
        </div>

        <div class="divider"></div>

        <h2>Turn Structure</h2>
        <div class="row"><span class="pill">A Round = P1 Turn ➜ P2 Turn</span><span class="pill">A Turn = Movement Phase ➜ Action Phase</span></div>

        <div class="notice">
            <div class="row"><strong>Movement Phase</strong> — 2 optional Move Slots</div>
            <div class="btn-row" id="moveSlots"></div>
            <div class="tiny muted">Movement (base): Guard 2 tiles, Champion/King 1. Injured max 1. Any direction.
            </div>
        </div>

        <div class="notice" style="margin-top:8px">
            <div class="row"><strong>Action Phase</strong> — Skill Slots</div>
            <div class="btn-row" id="skillSlots"></div>
            <div class="tiny muted">Start with 2 Skill Slots. +1 every 10 rounds (3 at Round 10, 4 at Round 20, ...). Pay rune cost before effect.
            </div>
        </div>

        <div style="margin-top:10px" class="btn-row">
            <button id="endTurn">End Turn ▶</button>
            <button class="secondary" id="toggleCapture">No capture this round</button>
            <button class="danger" id="resetGame">Reset Game</button>
        </div>

        <div class="row" style="margin-top:6px">
            <span class="muted tiny">Tip: Toggle "No capture this round" only once per round. It will reset automatically next round.</span>
        </div>

        <div class="divider"></div>

        <h2>Draw Conditions</h2>
        <ul class="tiny">
            <li>• <strong>DC1</strong>: No piece is captured for <strong>10 full rounds</strong>.</li>
            <li>• <strong>DC2</strong>: Only the two Kings remain on the board.</li>
        </ul>
        <div class="row">
            <span id="dc1" class="pill">DC1: OK</span>
            <span id="dc2" class="pill">DC2: OK</span>
        </div>
    </section>

    <section class="card">
        <h2>Players & Runes</h2>
        <div class="row">
            <div class="stat"><strong>P1 Runes</strong> <span id="p1Runes" class="val">0</span>
                <div class="counter">
                    <button class="secondary" data-rune-delta="-1" data-player="1">−</button>
                    <button class="secondary" data-rune-delta="+1" data-player="1">+</button>
                </div>
            </div>
            <div class="stat"><strong>P2 Runes</strong> <span id="p2Runes" class="val">0</span>
                <div class="counter">
                    <button class="secondary" data-rune-delta="-1" data-player="2">−</button>
                    <button class="secondary" data-rune-delta="+1" data-player="2">+</button>
                </div>
            </div>
        </div>
        <div class="tiny muted" style="margin-top:4px">Runes: Gain +1 at end of each round, scaling by +1 every 7 rounds (e.g., +2 at Round 7, +3 at Round 14, ...).</div>

        <div class="divider"></div>

        <h2>Piece Tracker</h2>
        <div class="grid cols-2">
            <div>
                <h3 class="muted">Player 1</h3>
                <div class="row">
                    <div class="stat"><span>Guards</span><span id="p1Guards" class="val">0</span>
                        <div class="counter">
                            <button class="secondary" data-piece="p1Guards" data-delta="-1">−</button>
                            <button class="secondary" data-piece="p1Guards" data-delta="+1">+</button>
                        </div>
                    </div>
                    <div class="stat"><span>Champions</span><span id="p1Champs" class="val">0</span>
                        <div class="counter">
                            <button class="secondary" data-piece="p1Champs" data-delta="-1">−</button>
                            <button class="secondary" data-piece="p1Champs" data-delta="+1">+</button>
                        </div>
                    </div>
                    <div class="stat"><span>King</span><span class="val">1</span></div>
                </div>
            </div>
            <div>
                <h3 class="muted">Player 2</h3>
                <div class="row">
                    <div class="stat"><span>Guards</span><span id="p2Guards" class="val">0</span>
                        <div class="counter">
                            <button class="secondary" data-piece="p2Guards" data-delta="-1">−</button>
                            <button class="secondary" data-piece="p2Guards" data-delta="+1">+</button>
                        </div>
                    </div>
                    <div class="stat"><span>Champions</span><span id="p2Champs" class="val">0</span>
                        <div class="counter">
                            <button class="secondary" data-piece="p2Champs" data-delta="-1">−</button>
                            <button class="secondary" data-piece="p2Champs" data-delta="+1">+</button>
                        </div>
                    </div>
                    <div class="stat"><span>King</span><span class="val">1</span></div>
                </div>
            </div>
        </div>

        <div class="divider"></div>
        <h2>Quick Notes</h2>
        <textarea id="notes" rows="6" style="width:100%;border-radius:12px;border:1px solid #2a357a;background:#0c1130;color:var(--text);padding:10px" placeholder="Optional: record key events, skills used, injuries/heals, bodyguard interceptions, etc."></textarea>

        <div class="footer tiny">All data auto-saves to your device (localStorage). Clearing with <em>Reset Game</em> will wipe it.</div>
    </section>
</div>

<script>
    // ---------- Utilities ----------
    const $ = sel => document.querySelector(sel);

    const defaultState = {
      round: 1,
      currentPlayer: 1, // 1 or 2
      p1: { runes: 0, guards: 0, champs: 0 },
      p2: { runes: 0, guards: 0, champs: 0 },
      roundsSinceCapture: 0,
      captureThisRound: false,
      notes: "",
      ui: { moveUsed: 0, skillUsed: 0 }
    };

    const LS_KEY = "turn-tracker-v1";

    function loadState(){
      try{ const s = JSON.parse(localStorage.getItem(LS_KEY)); if(s) return s; }catch(e){}
      return structuredClone(defaultState);
    }
    function saveState(){ localStorage.setItem(LS_KEY, JSON.stringify(state)); }

    let state = loadState();

    // ---------- Derived values ----------
    function runeGainForRound(round){
      // +1 base; increases by +1 every 7 rounds: +2 at 7..13, +3 at 14..20, ...
      return 1 + Math.floor(round / 7);
    }
    function skillSlotsForRound(round){
      // Start 2; +1 every 10 rounds: 3 at 10..19, 4 at 20..29, ...
      return 2 + Math.floor((round) / 10);
    }

    // ---------- Rendering ----------
    function render(){
      $('#round').textContent = state.round;
      $('#currentPlayer').textContent = state.currentPlayer === 1 ? 'P1' : 'P2';
      $('#rsc').textContent = state.roundsSinceCapture;
      $('#p1Runes').textContent = state.p1.runes;
      $('#p2Runes').textContent = state.p2.runes;
      $('#p1Guards').textContent = state.p1.guards;
      $('#p1Champs').textContent = state.p1.champs;
      $('#p2Guards').textContent = state.p2.guards;
      $('#p2Champs').textContent = state.p2.champs;
      $('#notes').value = state.notes;

      const runeGain = runeGainForRound(state.round);
      $('#runeGain').textContent = `+${runeGain}`;

      const slotsNow = skillSlotsForRound(state.round);
      $('#skillSlotsNow').textContent = slotsNow;

      // Movement slots (always 2 per turn)
      const moveWrap = $('#moveSlots');
      moveWrap.innerHTML = '';
      for(let i=0;i<2;i++){
        const el = document.createElement('label');
        el.className = 'slot';
        const cb = document.createElement('input');
        cb.type = 'checkbox';
        cb.checked = i < state.ui.moveUsed;
        cb.addEventListener('change', ()=>{
          if(cb.checked){ state.ui.moveUsed = Math.min(2, state.ui.moveUsed+1);} else { state.ui.moveUsed = Math.max(0, state.ui.moveUsed-1);} saveState(); render();
        });
        el.append(cb); el.append(document.createTextNode('Move'));
        moveWrap.append(el);
      }

      // Skill slots (scaling)
      const skillWrap = $('#skillSlots');
      skillWrap.innerHTML = '';
      for(let i=0;i<slotsNow;i++){
        const el = document.createElement('label');
        el.className = 'slot';
        const cb = document.createElement('input');
        cb.type = 'checkbox';
        cb.checked = i < state.ui.skillUsed;
        cb.addEventListener('change', ()=>{
          if(cb.checked){ state.ui.skillUsed = Math.min(slotsNow, state.ui.skillUsed+1);} else { state.ui.skillUsed = Math.max(0, state.ui.skillUsed-1);} saveState(); render();
        });
        el.append(cb); el.append(document.createTextNode('Skill'));
        skillWrap.append(el);
      }

      // Capture toggle button label
      const capBtn = $('#toggleCapture');
      capBtn.textContent = state.captureThisRound ? 'Capture happened ✔' : 'No capture this round';
      capBtn.className = state.captureThisRound ? 'ok' : 'secondary';

      // Draw checks
      const dc1 = $('#dc1');
      const dc2 = $('#dc2');
      const dc1Trig = state.roundsSinceCapture >= 10;
      const onlyKingsRemain = (state.p1.guards + state.p1.champs + state.p2.guards + state.p2.champs) === 0;

      dc1.textContent = dc1Trig ? 'DC1: DRAW (no capture for 10 rounds)' : `DC1: ${10 - state.roundsSinceCapture} rounds until draw`;
      dc1.className = 'pill ' + (dc1Trig ? 'warn' : '');

      dc2.textContent = onlyKingsRemain ? 'DC2: DRAW (only Kings remain)' : 'DC2: OK';
      dc2.className = 'pill ' + (onlyKingsRemain ? 'warn' : '');
    }

    // ---------- Interactions ----------
    // Rune +/-
    document.querySelectorAll('[data-rune-delta]').forEach(btn=>{
      btn.addEventListener('click', ()=>{
        const p = btn.getAttribute('data-player') === '1' ? state.p1 : state.p2;
        const d = parseInt(btn.getAttribute('data-rune-delta'));
        p.runes = Math.max(0, p.runes + d);
        saveState(); render();
      });
    });

    // Piece +/-
    document.querySelectorAll('[data-piece]').forEach(btn=>{
      btn.addEventListener('click', ()=>{
        const key = btn.getAttribute('data-piece');
        const d = btn.getAttribute('data-delta') === '+1' ? 1 : -1;
        const [player, prop] = key.startsWith('p1') ? [state.p1, key === 'p1Guards' ? 'guards':'champs'] : [state.p2, key === 'p2Guards' ? 'guards':'champs'];
        player[prop] = Math.max(0, player[prop] + d);
        saveState(); render();
      });
    });

    // Notes auto-save
    $('#notes').addEventListener('input', (e)=>{ state.notes = e.target.value; saveState(); });

    // Toggle capture flag for this round
    $('#toggleCapture').addEventListener('click', ()=>{
      state.captureThisRound = !state.captureThisRound; saveState(); render();
    });

    // End Turn logic
    $('#endTurn').addEventListener('click', ()=>{
      // next player or next round
      if(state.currentPlayer === 1){
        state.currentPlayer = 2;
      } else {
        state.currentPlayer = 1;
        // Round advances
        // Capture tracking for DC1
        if(state.captureThisRound){
          state.roundsSinceCapture = 0;
        } else {
          state.roundsSinceCapture += 1;
        }
        state.captureThisRound = false; // reset toggle for next round

        // Rune gain for BOTH players
        const gain = runeGainForRound(state.round);
        state.p1.runes += gain;
        state.p2.runes += gain;

        state.round += 1;
      }
      // Reset slots each new turn
      state.ui.moveUsed = 0;
      state.ui.skillUsed = 0;
      saveState(); render();
    });

    // Reset game
    $('#resetGame').addEventListener('click', ()=>{
      if(confirm('Reset game and clear all saved data?')){
        localStorage.removeItem(LS_KEY);
        state = structuredClone(defaultState);
        render();
      }
    });

    // Initial paint
    render();
</script>
</body>
</html>
